(this["webpackJsonpvote-fe"]=this["webpackJsonpvote-fe"]||[]).push([[0],{117:function(e,t,a){},147:function(e,t,a){e.exports=a(230)},152:function(e,t,a){},153:function(e,t,a){},170:function(e,t,a){},176:function(e,t,a){},198:function(e,t,a){},207:function(e,t,a){},208:function(e,t,a){},230:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(13),l=a.n(r),o=(a(152),a(24)),i=(a(153),a(16)),s=a(30),u=a.n(s),m=a(31),f=(a(170),a(241));function d(){return c.a.createElement("div",null,c.a.createElement("div",{className:"img img1"},c.a.createElement(f.a,null),c.a.createElement(m.b,{to:"/create-vote"},c.a.createElement("div",null,"\u521b\u5efa\u5355\u9009"))),c.a.createElement("div",{className:"img img2"},c.a.createElement(f.a,null),c.a.createElement(m.b,{to:"/create-vote?multiple=1"},c.a.createElement("div",null,"\u521b\u5efa\u591a\u9009"))))}a(176);var p=a(242),v=a(54);function E(e){var t=e.setUserInfo,a=Object(i.g)(),r=Object(n.useState)([]),l=Object(o.a)(r,2),s=l[0],f=l[1];Object(n.useEffect)((function(){u.a.get("/myvotes").then((function(e){f(e.data)}))}),[]),Object(n.useEffect)((function(){if(d[0]){var e=d[0].offsetHeight;e*=d.length,E.setAttribute("style","height:".concat(e,"px;"))}}));var d=document.getElementsByClassName("my-votes-li"),E=document.getElementById("votes-ul");return c.a.createElement("div",{className:"my-votes"},c.a.createElement("div",null,"\u6211\u521b\u5efa\u7684\u6295\u7968\u5217\u8868"),c.a.createElement("div",{className:"my-votes-list"},c.a.createElement("div",{id:"votes-ul",style:{height:"0"}},s.map((function(e,t){return c.a.createElement("li",{className:"my-votes-li",key:t},c.a.createElement(m.b,{to:"/vote/".concat(e.id)},c.a.createElement("span",null,e.title)),c.a.createElement("div",{onClick:function(){var a;a=e.id,u.a.delete("/vote/".concat(a)).then(),function(e){f(s.filter((function(t,a){return e!==a})))}(t)}},c.a.createElement(p.a,null),c.a.createElement("div",null,"\u5220\u9664")))}))),c.a.createElement(v.a,{type:"primary",size:"large",onClick:function(){u.a.get("./logout").then((function(){t(null),a.push("/login")}))}},"\u767b\u51fa")))}var g=a(243),h=a(244);function b(e){e.userInfo;var t=e.setUserInfo,a=Object(i.j)(),n=(a.path,a.url);Object(i.g)();return c.a.createElement("div",null,c.a.createElement(i.b,{path:"".concat(n,"/"),exact:!0},c.a.createElement(i.a,{to:"".concat(n,"/create")})),c.a.createElement(i.b,{path:"".concat(n,"/create")},c.a.createElement(d,null)),c.a.createElement(i.b,{path:"".concat(n,"/my")},c.a.createElement(E,{setUserInfo:t})),c.a.createElement("div",{className:"foot-bar"},c.a.createElement(m.c,{className:"fb f-create",activeClassName:"active",to:"".concat(n,"/create")},c.a.createElement(g.a,null),"\u65b0\u5efa"),c.a.createElement(m.c,{className:"fb f-my",activeClassName:"active",to:"".concat(n,"/my")},c.a.createElement(h.a,null),"\u6211\u7684")))}var y=a(44),O=a.n(y),j=a(51),w=a(245),N=a(246),k=a(236);a(117);function x(e){var t=e.setUserInfo,a=Object(n.useRef)(),r=Object(n.useRef)(),l=Object(i.g)();function o(){return(o=Object(j.a)(O.a.mark((function e(n){var c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,u.a.post("/login",{name:a.current.state.value,password:r.current.state.value});case 4:c=e.sent,t(c.data),l.push("/"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}return c.a.createElement("div",{id:"login-father"},c.a.createElement("form",{id:"login"},c.a.createElement(k.a,{type:"text",ref:a,prefix:c.a.createElement(w.a,{className:"site-form-item-icon"}),placeholder:"\u7528\u6237\u540d"}),c.a.createElement(k.a,{type:"password",ref:r,prefix:c.a.createElement(N.a,{className:"site-form-item-icon"}),placeholder:"\u5bc6\u7801"}),c.a.createElement(v.a,{type:"primary",className:"login-form-button",onClick:function(e){return o.apply(this,arguments)}},"\u767b\u5f55"),c.a.createElement(v.a,{type:"primary",className:"login-form-button",onClick:function(e){e.preventDefault(),l.push("/Register")}},"\u6ce8\u518c")))}var C=a(65),I=a(233),D=a(238),S=a(50),U=a.n(S),B=a(234),R=a(239),L=a(247),M=a(248),T=(a(198),a(79));function A(){var e=new URLSearchParams(Object(i.h)().search),t=Object(n.useState)(["",""]),a=Object(o.a)(t,2),r=a[0],l=a[1],s=Object(I.a)(),m=Object(I.a)(),f=Object(n.useState)(""),d=Object(o.a)(f,2),p=d[0],E=d[1],g=Object(D.a)(),h=Object(i.g)(),b=Object(D.a)("1"===e.get("multiple")),y=new Date;function w(){return(w=Object(j.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,u.a.post("/vote",{title:s.value,desc:m.value,options:r,deadline:new Date(p).toISOString(),anonymous:g.value?1:0,isMultiple:b.value?1:0});case 4:t=e.sent,h.push("/vote/"+t.data.voteId),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),alert("\u521b\u5efa\u5931\u8d25"+e.t0.toString());case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}return y=y.setDate(y.getDate()+1),y=new Date(y).toLocaleString(),Object(n.useEffect)((function(){setTimeout((function(){var e=document.getElementById("create-ul"),t=document.getElementsByClassName("create-li");if(console.log("ul",e),console.log("li",t),t[0]){var a=t[0].offsetHeight;a*=t.length,e.setAttribute("style","height:".concat(a,"px;"))}}),100)})),c.a.createElement("div",{className:"create-votes"},c.a.createElement("h3",null,"\u521b\u5efa\u6295\u7968"),c.a.createElement("li",{className:"cv-title"},c.a.createElement(k.a,{type:"text",value:s.value,onChange:s.onChange,placeholder:"\u6295\u7968\u6807\u9898"})),c.a.createElement("li",{className:"cv-desc"},c.a.createElement(k.a,{type:"text",value:m.value,onChange:m.onChange,placeholder:"\u8865\u5145\u63cf\u8ff0\uff08\u9009\u586b\uff09"})),c.a.createElement("div",{id:"create-ul",style:{height:"110px"}},r.map((function(e,t){return c.a.createElement("li",{key:t,className:"create-li"},c.a.createElement("div",{className:"redX",onClick:function(){return function(e){2!==r.length&&l(r.filter((function(t,a){return e!==a})))}(t)}},c.a.createElement(L.a,null)),c.a.createElement(k.a,{type:"text",value:e,placeholder:"\u9009\u9879",onChange:function(e){e.persist(),console.log(e.target.value),l([].concat(Object(C.a)(r.slice(0,t)),[e.target.value],Object(C.a)(r.slice(t+1))))}}))}))),c.a.createElement("div",{className:"setOptions",onClick:function(){return l([].concat(Object(C.a)(r),[""]))}},c.a.createElement(M.a,null),"\u70b9\u51fb\u6dfb\u52a0\u9009\u9879"),c.a.createElement("div",{id:"cv-bottom"},c.a.createElement("li",null,c.a.createElement("span",null,"\u622a\u6b62\u65e5\u671f\uff1a"),c.a.createElement(B.a,{placeholder:y,disabledDate:function(e){return e<=U()().add(1,"days").startOf("day")},format:"YYYY-MM-DD HH:mm:ss",onChange:function(e,t){console.log("date+dateString",e,t),E(t)}})),c.a.createElement("li",null,"\u533f\u540d\u6295\u7968\uff1a",c.a.createElement(R.a,{checkedChildren:"\u5f00\u542f",unCheckedChildren:"\u5173\u95ed",checked:g.valuechecked,onClick:g.toggle})),c.a.createElement("li",{id:"multiple"},"\u591a\u9009\uff1a",c.a.createElement(R.a,{checkedChildren:"\u5f00\u542f",unCheckedChildren:"\u5173\u95ed",checked:b.value,onClick:b.toggle}))),c.a.createElement("li",{className:"create-now"},c.a.createElement(v.a,{type:"primary",className:"login-form-button",onClick:function(){return w.apply(this,arguments)}},"\u521b\u5efa")))}a(207);function Y(e){var t,a,r=e.userInfo,l=Object(i.i)().id,s=Object(n.useState)(!0),m=Object(o.a)(s,2),f=m[0],d=m[1],p=Object(n.useState)(null),v=Object(o.a)(p,2),E=v[0],g=v[1],h=Object(n.useState)(null),b=Object(o.a)(h,2),y=b[0],w=b[1];Object(i.g)();function N(){return(N=Object(j.a)(O.a.mark((function e(t,a){var n,c,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Date.now()>new Date(E.deadline).getTime())){e.next=3;break}return alert("\u8be5\u6295\u7968\u5df2\u7ecf\u8fc7\u671f"),e.abrupt("return");case 3:return a?(c=y.filter((function(e){return!(e.userId==r.id&&t==e.optionId)})),w(c)):(n={id:-1,optionId:t,voteId:l,userId:r.id,avatar:r.avatar},console.log("\u589e\u52a0\u672c\u6b21\u6295\u7968"),w([].concat(Object(C.a)(y),[n]))),e.next=6,u.a.post("/voteup/".concat(l),{optionId:t,isVoteDown:a});case 6:o=e.sent,console.log("res.data:"+o.data);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return f||(t=Object(T.groupBy)(y,"optionId"),a=Object(T.uniqBy)(E.votings,"userId").length,console.log("groupedVotings:",t)),Object(n.useEffect)((function(){g(null),d(!0),u.a.get("/vote/".concat(l)).then((function(e){g(e.data),w(e.data.votings),d(!1)}))}),[l]),Object(n.useEffect)((function(){if(E&&Date.now()<new Date(E.deadline).getTime()){console.log("ws \u91cd\u65b0\u8fde\u63a5");var e=new WebSocket("ws://".concat(location.host,"/vote/").concat(l));return e.onmessage=function(e){w(JSON.parse(e.data))},function(){return e.close()}}}),[l,E]),f?c.a.createElement("div",null,"loading..."):(console.log("voteInfo:",E),c.a.createElement("div",null,c.a.createElement("h2",{className:"view-title"},E.title),c.a.createElement("p",{className:"view-desc"},E.desc,c.a.createElement("span",null,E.isMultiple?"[\u591a\u9009]":"[\u5355\u9009]")),c.a.createElement("ul",null,E.options.map((function(e){var n=t[e.id]||[];console.log("currVotings",n),console.log("userInfo:",r,e);var l=!!n.find((function(e){return e.userId==r.id}));return console.log(l),c.a.createElement("li",{className:"view-vote-li",key:e.id,onClick:function(){return function(e,t){return N.apply(this,arguments)}(e.id,l)}},c.a.createElement("div",{className:"bgc-white"},c.a.createElement("div",{className:"view-option"},c.a.createElement("div",null,c.a.createElement("input",{type:"checkbox",checked:l}),c.a.createElement("span",{className:"option-text"},e.content)),c.a.createElement("strong",null,c.a.createElement("span",null,n.length,"\u7968"),c.a.createElement("span",null,F(n.length,a),"%")),c.a.createElement("div",{className:"option-ratio",style:{width:F(n.length,a)+"%"}}))),c.a.createElement("ul",{className:"avatars"},n.map((function(e){return c.a.createElement("li",{key:e.avatar},c.a.createElement("img",{className:"avatar",src:e.avatar}))}))))}))),c.a.createElement("p",null,"\u6295\u7968\u622a\u81f3\uff1a",new Date(E.deadline).toLocaleString())))}function F(e,t){return 0==t?0:(e/t*100).toFixed(2)}var H=a(130),J=a(131),P=a(145),V=a(143),W=a(249),z=a(250),G=a(251),q=a(240),X=a(235),$=(a(208),{});function K(e,t){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)})),a.readAsDataURL(e)}function Q(e){var t="image/jpeg"===e.type||"image/png"===e.type;$.file=e,t||q.b.error("You can only upload JPG/PNG file!");var a=e.size/1024/1024<2;return a||q.b.error("Image must smaller than 2MB!"),$.file=e,t&&a}var Z=function(e){Object(P.a)(a,e);var t=Object(V.a)(a);function a(){var e;Object(H.a)(this,a);for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={loading:!1},e.handleChange=function(t){"uploading"!==t.file.status?("done"===t.file.status&&K(t.file.originFileObj,(function(t){return e.setState({imageUrl:t,loading:!1})})),console.log($)):e.setState({loading:!0})},e}return Object(J.a)(a,[{key:"render",value:function(){var e=this.state,t=e.loading,a=e.imageUrl,n=c.a.createElement("div",null,t?c.a.createElement(W.a,null):c.a.createElement(z.a,null),c.a.createElement("div",{style:{marginTop:8}},"Upload"));return c.a.createElement(X.a,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,action:"https://www.mocky.io/v2/5cc8019d300000980a055e76",beforeUpload:Q,onChange:this.handleChange},a?c.a.createElement("img",{src:a,alt:"avatar",style:{width:"100%"}}):n)}}]),a}(c.a.Component);function _(e){e.setUserInfo;var t=Object(n.useRef)(null),a=Object(n.useRef)(null),r=Object(n.useRef)(null),l=Object(i.g)();function o(){return(o=Object(j.a)(O.a.mark((function e(n){var c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),(c=new FormData).append("name",t.current.state.value),c.append("password",a.current.state.value),c.append("email",r.current.state.value),c.append("avatar",$.file),void 0!=t.current.state.value&&void 0!=a.current.state.value&&void 0!=r.current.state.value){e.next=9;break}return alert("\u8bf7\u586b\u5199\u5b8c\u6574\u6ce8\u518c\u4fe1\u606f"),e.abrupt("return");case 9:return e.prev=9,e.next=12,u.a.post("/register",c).then((function(e){console.log(e),alert("\u6ce8\u518c\u6210\u529f\uff0c\u8bf7\u767b\u5f55"),l.push("/Login")}));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[9,14]])})))).apply(this,arguments)}return c.a.createElement("div",{id:"register-father"},c.a.createElement("form",{id:"register",method:"post",action:"/register",encType:"formdata/multipart"},c.a.createElement(k.a,{type:"text",ref:t,prefix:c.a.createElement(w.a,{className:"site-form-item-icon"}),placeholder:"\u7528\u6237\u540d"}),c.a.createElement(k.a,{type:"text",ref:r,prefix:c.a.createElement(G.a,{className:"site-form-item-icon"}),placeholder:"\u90ae\u7bb1"}),c.a.createElement(k.a,{type:"password",ref:a,prefix:c.a.createElement(N.a,{className:"site-form-item-icon"}),placeholder:"\u5bc6\u7801"}),c.a.createElement(Z,{name:"avatar"}),c.a.createElement(v.a,{type:"primary",className:"login-form-button",onClick:function(e){return o.apply(this,arguments)}},"\u6ce8\u518c")))}var ee=function(){var e=Object(i.g)(),t=Object(n.useState)({}),a=Object(o.a)(t,2),r=a[0],l=a[1];return Object(n.useEffect)((function(){u.a.get("/userinfo").then((function(e){console.log(e.data),l(e.data)})).catch((function(t){e.push("/login")}))}),[]),c.a.createElement("div",{className:"App"},c.a.createElement(i.d,null,c.a.createElement(i.b,{path:"/",exact:!0},c.a.createElement(i.a,{to:"home"})),c.a.createElement(i.b,{path:"/login"},c.a.createElement(x,{setUserInfo:l})),c.a.createElement(i.b,{path:"/register"},c.a.createElement(_,null)),c.a.createElement(i.b,{path:"/home"},r&&c.a.createElement(b,{userInfo:r,setUserInfo:l})),c.a.createElement(i.b,{path:"/create-vote"},c.a.createElement(A,null)),c.a.createElement(i.b,{path:"/vote/:id"},r&&c.a.createElement(Y,{userInfo:r}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(m.a,null,c.a.createElement(ee,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[147,1,2]]]);
//# sourceMappingURL=main.62206e91.chunk.js.map